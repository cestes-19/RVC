---
title: "iNEXT"
author: "Megan Hepner"
date: "6/11/2017"
output: html_document
---
## example for abundance based data (list of vector)
data(spider)
out1 <- iNEXT(spider, q=0, datatype="abundance")
out1$DataInfo # showing basic data information.
out1$iNextEst # showing diversity estimates with rarefied and extrapolated and related statistics.
out1$AsyEst # showing asymptotic diversity estimates with related statistics.


$DataInfo: 
n - returns basic data information including the reference sample size 
S.obs - observed species richness 
SC - a sample coverage estimate 
f1-f10 - the first ten frequency counts

$iNextEst: 
m - the sample size 
method - the method (interpolated, observed, or extrapolated, depending on whether the size m is less than, equal to, or greater than the reference sample size
order - the diversity order
qD - the diversity estimate of order q
qD.LCL, qD.UCL- the 95% lower and upper confidence limits of diversity 
SC - the sample coverage estimate
SC.LCL, SC.UC - the 95% lower and upper confidence limits of sample coverage.

$AsyEst: asymptotic diversity estimates along with related statistics.
Observed - observed diversity, 
Estimator - asymptotic estimates, 
EST_s.e. - estimated bootstrap s.e. 
Lower_CI, Upper_CI - 95% confidence intervals 

```{r setup, include=FALSE}

trait_matrix = read_csv('functional_diversity/species_trait_matrix_348_spp.csv')
trait_matrix = trait_matrix %>%
  as.tibble() %>%
  mutate(
    SPECIES_CD = toupper(as.character(SPECIES_CD))) %>% 
  arrange(SPECIES_CD)

domain_fk_abun <- read_csv('big_csv/abundance_domain/domain_fk_abun.csv', 
                           col_types = cols(
                             YEAR = col_integer(),
                             REGION = col_character(),
                             SPECIES_CD = col_character(),
                             abundance = col_double(),
                             var = col_double(),
                             n = col_integer(),
                             nm = col_integer(),
                             N = col_double(),
                             NM = col_double(),
                             protected_status = col_character()
                           ))

domain_fk_abun_no_spp = domain_fk_abun %>%
  filter(!stringr::str_detect(SPECIES_CD, 'SPE\\.$')) #348 species 

## FK's domain abundance only identified to species level (without spp.) 
fk_domain_abun_diversity_no_spp = domain_fk_abun_no_spp %>% #14,634 * 10
  filter(protected_status == "all") %>% 
  group_by(YEAR, SPECIES_CD) %>% ##45 groups (fk 15*3)
  summarise(abundance = sum(abundance)) %>%
  select(YEAR, SPECIES_CD, abundance) %>%
  spread(SPECIES_CD, abundance, fill =0)

trial = as.data.frame(t(fk_domain_abun_diversity_no_spp[,-1])) #loose row names with year as new column 

test = iNEXT(trial, q=c(0,1,2), datatype = "abundance") #data needs to be species by sites 

#sample-site based R/E curves, seperating by "site" aka year 
ggiNEXT(test, type=3, facet.var = "site") +
  theme_bw(base_size = 18)
#sample-site based R/E curves, seperating by "order" aka richness, simpson, shannon
ggiNEXT(test, type=1, facet.var = "order")

ggiNEXT(test, type=3, facet.var = "order", color.var = "site")
  
```

```{r iNEXT example}
data(spider)
out1 <- iNEXT(spider, q=0, datatype="abundance")
```

