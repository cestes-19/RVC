---
title: "MBON SDG14 FKNMS Ecological Classifications"
author: "Megan Hepner"
date: "May 5, 2017"
output: html_document
---

## Sustainable Development Goal 

SDG14: Conserve and sustainably use the oceans, seas and marine resources
    + SDG14.2:VBy 2020, sustainably manage, and protect marine and coastal ecosystems to avoid significant adverse impacts, including by strengthening their resilience and take action for their restoration, to achieve healthy and productive oceans

## National Marine Sanctuary Condition Report Questions 

### Water Quality 
1. What is the eutrophic condition of the sanctuary waters and how is it changing?
2. Do sanctuary waters pose risks to human health and how are they changing?
3. Have recent changes in climate alter water conditions and how are they changing?
4. Are other stressors, individually or in combination, affecting water quality, and how are they changing?

### Habitat Resources 
5. What is the integrity of major habitat types and how are they changing?
6. What are contaminant concentrations in sanctuary habitats and how are they changing?

### Living Resources 
7. What is the status and trend of keystone and foundation species and how is it changing?
8. What is the status and trend of other focal species and how is it changing?
9. What is the status of non-indigenous species and how is it changing?
10. What is the status of biodiversity and how is it changing?

### Maritime Archeological Resources  
11. What is the archaeological integrity of known maritime archaeological resources and how is it changing? 
12. Do known maritime archaeological resources pose an environmental hazard and how is this threat changing?

### Human Demensions 
13. What are the levels of human activities that may adversely influence water quality and how are they changing? 
14. What are the levels of human activities that may adversely influence habitats and how are they changing?
15. What are the levels of human activities that may adversely influence living resource quality and how are they changing? 
16. What are the levels of human activities that may adversely influence maritime archaeological resource quality and how are they changing?
17. What are the states of influential human drivers and how are they changing?


## FKNMS Infographic data 

| Sanctuary Classification level | Icon                   | Metric                      | Dataset |  
|:-------------------------------|:-----------------------|:----------------------------|:--------|
| Foundation species             | Stony coral            | percent cover & diseased    | CREMP   |
| Foundation species             | Sea fan                | percent cover & diseased    | CREMP   |
| Foundation species             | Macroalgae             | percent cover & diseased    | CREMP   |         
| Foundation species             | Sponges                | percent cover & diseased    | CREMP   |         
| Keystone species               | Long-spinned sea urchin| abundance                   | TBD     |
| Focal species                  | Caribbean spiny lobster| abundance                   | TBD     |
| Focal species                  | Queen Conch            | abundance                   | TBD     |
| Focal species (threatened)     | Sea turtles            | abundance                   | TBD     |
| Biodiversity                   | Reef fish biodiversity | diversity index             | RVC     |
| Trophic groups                 | Forage fish            | abundance, simpson, shannon | RVC     |
| Trophic groups (exploited)     | Groupers               | abundance, simpson, shannon | RVC     |
| Trophic groups                 | Grunts                 | abundance, simpson, shannon | RVC     |
| Trophic groups                 | Higher level reef fish | abundance, simpson, shannon | RVC     |
| Trophic groups (exploited)     | Hogfish                | abundance, simpson, shannon | RVC     |
| Trophic groups (invasive)      | Lionfish               | abundance                   | RVC     |
| Trophic groups                 | Opportunists           | abundance, simpson, shannon | RVC     |
| Trophic groups (herbivores)    | Parrotfish             | abundance, simpson, shannon | RVC     |
| Trophic groups                 | Rays                   | abundance, simpson, shannon | RVC     |
| Trophic groups                 | Seabass and Hamlets    | abundance, simpson, shannon | RVC     |
| Trophic groups (apex)          | Sharks                 | abundance, simpson, shannon | RVC     |
| Trophic groups                 | Small reeffish         | abundance, simpson, shannon | RVC     |
| Trophic groups (exploited)     | Snappers               | abundance, simpson, shannon | RVC     |

    
```{r librarys}

library(knitr)
library(tidyverse)
library(rvc)
library(vegan)
#library(rfishbase)

```

```{r call RVC data}

#RVCdata_FK <- getRvcData(1999:2016, "FLA KEYS", server = 'https://www.sefsc.noaa.gov/rvc_analysis20/')

#write_csv(RVCdata_FK, 'big_csv/RVCdata_FK.csv')

#RVCdata_DT <- getRvcData(1999:2016, "FLA KEYS", server = 'https://www.sefsc.noaa.gov/rvc_analysis20/')

# species_list <- RVCdata_FK$taxonomic_data %>%
#   select(SPECIES_CD,FAMILY, SCINAME, COMNAME) %>%
#   arrange(desc(FAMILY))
# 
# species_family_list <- unique(RVCdata_FK$taxonomic_data$FAMILY)
# species_family_list[order(species_family_list)]
   
```

#### Read in abundance and diversity csv files for trophic groups 
```{r csv files}

# read in all abundance csv files for trophic groups 
path = "big_csv/trophic_groups/abundance/"
files = list.files(path=path, pattern = "*.csv")
for(file in files)
{
perpos <- which(strsplit(file, "")[[1]]==".")
assign(
gsub(" ","",substr(file, 1, perpos-1)), 
read.csv(paste(path, file, sep= "")))  
}

path = "big_csv/trophic_groups/diversity/"
files = list.files(path=path, pattern = "*.csv")
for(file in files)
{
perpos <- which(strsplit(file, "")[[1]]==".")
assign(
gsub(" ","",substr(file, 1, perpos-1)), 
read.csv(paste(path, file, sep= "")))  
}

```

## Trophic groups
- Forage fish 
- Grouper
- Grunts
- Higher Level Reef Fish
- Hogfish
- Lionfish
- Opportunists 
- Parrotfish
- Rays
- Sea bass and Hamlets
- Sharks
- Small Reef Fish
- Snapper

#### Forage fish
```{r Forage fish, eval = F}

forage_fish_spp_list= c("HYP HARR", "ATH STIP", "JEN SPE.", "HAR JAGU", "ANC LYOL", "INE VITT", "HEM BRAS", "SAR AURI", "HAR HUME", "CHR ATHE")

#abundance
forage_fk_abun = getDomainAbundance(RVCdata_FK, forage_fish_spp_list, merge_protected = F)
write_csv(forage_fk_abun, "big_csv/trophic_groups/abundance/forage_fk_abun.csv")

forage_dt_abun = getDomainAbundance(RVCdata_FK, forage_fish_spp_list, merge_protected = F)
write_csv(forage_dt_abun, "big_csv/trophic_groups/abundance/forage_dt_abun.csv")

#density
forage_fk_den = getDomainDensity(RVCdata_DT, forage_fish_spp_list, merge_protected = F)
write_csv(forage_fk_den, "big_csv/trophic_groups/density/forage_fk_den.csv")

forage_dt_den = getDomainDensity(RVCdata_DT, forage_fish_spp_list, merge_protected = F)
write_csv(forage_dt_den, "big_csv/trophic_groups/density/forage_dt_den.csv")

#diversity metrics 
forage_fk_abundance = forage_fk_abun %>% 
  select(YEAR, protected_status, SPECIES_CD, abundance) %>%  
  group_by(YEAR, protected_status) %>% #48 groups 
  nest(-YEAR) %>%  
  mutate(
    data_wide = map(data, ~ spread(data=.x, SPECIES_CD, abundance, fill = 0)), 
     #species richness 
    forage_richness = map(
      data_wide, 
      function(x) specnumber(x)),
    #simpson diversity as effective number of species 
    forage_simpson = map( 
      data_wide,
      function(x) 1/(1 - diversity(x, index = 'simpson'))),
     #shannon diversity as effective number of species 
    forage_shannon = map(
      data_wide,
      function(x) exp(diversity(x, index = 'shannon')))) %>%
  unnest(forage_richness, forage_simpson, forage_shannon)

forage_fk_diversity = forage_fk_abundance %>%
  select(YEAR, protected_status, forage_richness, forage_shannon, forage_simpson) 
write_csv(forage_fk_diversity, "big_csv/trophic_groups/diveristy/forage_fk_diversity.csv")
  
```

#### Grouper
```{r Grouper, eval = F}

grouper_spp_list= c("CEP CRUE", "MYC BONA", "EPI MORI", "EPI STRI", "EPI ITAJ", "CEP FULV", "MYC MICR", "MYC PHEN", "MYC VENE", "MYC INTE", "MYC TIGR", "EPI FLAV", "DER INER", "SRR SPE.", "Epi nive", "Myc acut")

#abundance
grouper_fk_abun = getDomainAbundance(RVCdata_FK, grouper_spp_list, merge_protected = F)
write_csv(grouper_fk_abun, "big_csv/trophic_groups/abundance/grouper_fk_abun.csv")

grouper_dt_abun = getDomainAbundance(RVCdata_FK, grouper_spp_list, merge_protected = F)
write_csv(grouper_dt_abun, "big_csv/trophic_groups/abundance/grouper_dt_abun.csv")

#density
grouper_fk_den = getDomainDensity(RVCdata_DT, grouper_spp_list, merge_protected = F)
write_csv(grouper_fk_den, "big_csv/trophic_groups/density/grouper_fk_den.csv")

grouper_dt_den = getDomainDensity(RVCdata_DT, grouper_spp_list, merge_protected = F)
write_csv(grouper_dt_den, "big_csv/trophic_groups/density/grouper_fk_den.csv")

#diversity metrics 
grouper_fk_abundance = forage_fk_abun %>% 
  select(YEAR, protected_status, SPECIES_CD, abundance) %>%  
  group_by(YEAR, protected_status) %>% 
  nest(-YEAR) %>%  
  mutate(
    data_wide = map(data, ~ spread(data=.x, SPECIES_CD, abundance, fill =0)), 
     #species richness 
    grouper_richness = map(
      data_wide, 
      function(x) specnumber(x)),
    #simpson diversity as effective number of species 
    grouper_simpson = map( 
      data_wide,
      function(x) 1/(1 - diversity(x, index = 'simpson'))),
     #shannon diversity as effective number of species 
    grouper_shannon = map(
      data_wide,
      function(x) exp(diversity(x, index = 'shannon')))) %>%
  unnest(grouper_richness, grouper_simpson, grouper_shannon)

grouper_fk_diversity = grouper_fk_abundance %>%
  select(YEAR, protected_status, grouper_richness, grouper_shannon, grouper_simpson) 
write_csv(grouper_fk_diversity, "big_csv/trophic_groups/diversity/grouper_fk_diversity.csv")

```

#### Grunts 
```{r Grunts, eval = F}

grunt_spp_list = c("HAE SCIU", "HAE AURO", "HAE PLUM", "HAE SPE.", "HAE FLAV", "HAE CHRY", "ANI VIRG","HAE MELA", "HAE CARB", "HAE PARR", "HAE STRI", "HAE MACR", "ANI SURI", "HAE ALBU")

#abundance
grunt_fk_abun = getDomainAbundance(RVCdata_FK, grunt_spp_list, merge_protected = F)
write_csv(grunt_fk_abun, "big_csv/trophic_groups/abundance/grunt_fk_abun.csv")

grunt_dt_abun = getDomainAbundance(RVCdata_FK, grunt_spp_list, merge_protected = F)
write_csv(grunt_dt_abun, "big_csv/trophic_groups/abundance/grunt_dt_abun.csv")

#density
grunt_fk_den = getDomainDensity(RVCdata_DT, grunt_spp_list, merge_protected = F)
write_csv(grunt_fk_den, "big_csv/trophic_groups/density/grunt_fk_den.csv")

grunt_dt_den = getDomainDensity(RVCdata_DT, grunt_spp_list, merge_protected = F)
write_csv(grunt_dt_den, "big_csv/trophic_groups/density/grunt_dt_den.csv")

#diversity metrics 
grunt_fk_abundance = grunt_fk_abun %>% 
  select(YEAR, protected_status, SPECIES_CD, abundance) %>%  
  group_by(YEAR, protected_status) %>% #48 groups 
  nest(-YEAR) %>%  
  mutate(
    data_wide = map(data, ~ spread(data=.x, SPECIES_CD, abundance, fill = 0)), 
     #species richness 
    grunt_richness = map(
      data_wide, 
      function(x) specnumber(x)),
    #simpson diversity as effective number of species 
    grunt_simpson = map( 
      data_wide,
      function(x) 1/(1 - diversity(x, index = 'simpson'))),
     #shannon diversity as effective number of species 
    grunt_shannon = map(
      data_wide,
      function(x) exp(diversity(x, index = 'shannon')))) %>%
  unnest(grunt_richness, grunt_simpson, grunt_shannon)

grunt_fk_diversity = grunt_fk_abundance %>%
  select(YEAR, protected_status, grunt_richness, grunt_simpson, grunt_shannon) 
write_csv(grunt_fk_diversity, "big_csv/trophic_groups/diveristy/grunt_fk_diversity.csv")

```

#### Higher Level Reef Fish
```{r Higher Level Reef Fish, eval = F}

higher_reef_spp_list = c("THA BIFA","STE PART","GYM MORI","PRI AREN","ABU SAXA","HAL BIVI","HAL GARN","HAL MACU","CHR MULT","CLE PARR","STE PLAN","CHR CYAN","MUL MART","MIC CHRY","STE ADUS","CHA CAPI","STE VARI","PEM SCHO","POM ARCU","CAN ROST","CHA OCEL","PSE MACU","HOL TRIC","CHR SCOT","HAL RADI","CAL CALA","CHA SEDE","XYR SPLE","STE LEUC","HOL CILI","POM PARU","AUL MACU","CHA STRI","OPI AURI","HAL POEY","CHR INSO","HOL ADSC","ODO DENT","STE DIEN","HOL BERM","CHA FABE","XYR MART","GER CINE","HOL RUFU","LAC TRIQ","PAR ACUM","ALU SCRI","BAL CAPR","MAL PLUM","CAN SUFF","CAN PULL","HET CRUE","OGC SPE.","XYR SPE.","ACA QUAD","CAL BAJO","MON TUCK","SPH SPEN","ARC RHOM","DIO HOLO","LAC BICA","XYR NOVA","BAL VETU","DIO HYST","HAL CYAN","GYM FUNE","DIP HOLB","APO PSEU","HOL TOWN","EQU PUNC","LAC TRIG","HAL PICT","MYR JACO","SAR VEXI","SYN INTE","HAL CAUD","AMB PINO","GYM MILI","ALU SCHO","ACA POLY","CAL PROR","CHI SCHO","HET LONG","SCO PLUM","CHR ENCH","CAL SPE.","APO MACU","CAN MACR","PAR UMBR","LAG RHOM","EQU LANC","CAL PENN","STE HISP","APO BINO","NEO MARI","ARC PROB","CHI ANTE","APO TOWN","DOR MEGA","REM REMO","OPI WHIT","CEN ARGI","SYN FOET","AST SPE.","CAR HIPP","SAR CORU","OPI MACR","GYM VICI","DIP ARGE","PAG PAGR","PAR BAIR","BOT LUNA","EUC ARGE","PRO ACUL","LAB GOBI","FIS TABA","ALU SPE.","GRA LORE","MON CILI","ECH NEUC","ALU MONO","BOT OCEL","BAL SPE.","PAR ALBI","STE SPE.","APO QUAD","ENC NIGR","GYM SAXI","OPI SPE.","ELO SAUR","MAN BIRO","APO AURO","SPH TEST","CAL NODO","DIO SPE.","SCO CARI","LAB FILA","AHL EGMO","ANT OCEL","AST GUTT","LAB SPE.","LAB SPE.","MUR RETI","AST STEL","EUC GULA","HOL SPE.","ORT CHRY","PRI OPHR","LAB BUCC","ACA SOLA","CAL LEUC","ENC CARY","GYM NIGR","MYR BREV","SAR BULL","TRA GOOD","TRA LATH","UMB CORO","EUC JONE","EUCLEFR","STY LATE","SYA MICR","SYN SCOV","APO PHEN","HIP REID","PHA XENU","AST PUNC","CHI ATIN","CHL CHRY","HIP EREC","OGC NASU","SER PHOE","SPH NEPH","MYR OCEL","PRI RUBI","RHI LENT","ALB VULP","DAC VOLI","RYP BIST","BRO BARB","HYP GUMM","OPS TAU_","EMM ATLA","UPE PARV","SYN SYNO")

#abundance
higher_reef_fk_abun = getDomainAbundance(RVCdata_FK, higher_reef_spp_list, merge_protected = F)
write_csv(higher_reef_fk_abun, "big_csv/trophic_groups/abundance/higher_reef_fk_abun.csv")

higher_reef_dt_abun = getDomainAbundance(RVCdata_FK, higher_reef_spp_list, merge_protected = F)
write_csv(higher_reef_dt_abun, "big_csv/trophic_groups/abundance/higher_reef_dt_abun.csv")

#density
higher_reef_fk_den = getDomainDensity(RVCdata_DT, higher_reef_spp_list, merge_protected = F)
write_csv(higher_reef_fk_den, "big_csv/trophic_groups/density/higher_reef_fj_den.csv")

higher_reef_dt_den = getDomainDensity(RVCdata_DT, higher_reef_spp_list, merge_protected = F)
write_csv(higher_reef_dt_den, "big_csv/trophic_groups/density/higher_reef_dt_den.csv")

higher_reef_fk_abundance = higher_reef_fk_abun %>% 
  select(YEAR, protected_status, SPECIES_CD, abundance) %>%  
  group_by(YEAR, protected_status) %>% #48 groups 
  nest(-YEAR) %>%  
  mutate(
    data_wide = map(data, ~ spread(data=.x, SPECIES_CD, abundance, fill = 0)), 
     #species richness 
    richness = map(
      data_wide, 
      function(x) specnumber(x)),
    #simpson diversity as effective number of species 
    simpson = map( 
      data_wide,
      function(x) 1/(1 - diversity(x, index = 'simpson'))),
     #shannon diversity as effective number of species 
    shannon = map(
      data_wide,
      function(x) exp(diversity(x, index = 'shannon')))) %>%
  unnest(richness, simpson, shannon)

higher_reef_diversity = higher_reef_fk_abundance %>%
  select(YEAR, protected_status, richness, simpson, shannon) 
write_csv(higher_reef_diversity, "big_csv/trophic_groups/diversity/higher_reef_fk_diversity.csv")

```

#### Hogfish
```{r Hogfish, eval = F}

hogfish_spp_list = c("LAC MAXI", "BOD RUFU", "BOD PULC")

#abundance
hogfish_fk_abun = getDomainAbundance(RVCdata_FK, hogfish_spp_list, merge_protected = F)
write_csv(hogfish_fk_abun, "big_csv/trophic_groups/abundance/hogfish_fk_abun.csv")

hogfish_dt_abun = getDomainAbundance(RVCdata_FK, hogfish_spp_list, merge_protected = F)
write_csv(hogfish_dt_abun, "big_csv/trophic_groups/abundance/hogfish_dt_abun.csv")

#density
hogfish_fk_den = getDomainDensity(RVCdata_DT, hogfish_spp_list, merge_protected = F)
write_csv(hogfish_fk_den, "big_csv/trophic_groups/density/hogfish_fk_den.csv")

hogfish_dt_den = getDomainDensity(RVCdata_DT, hogfish_spp_list, merge_protected = F)
write_csv(hogfish_dt_den, "big_csv/trophic_groups/density/hogfish_dt_den.csv")

hogfish_fk_abundance = hogfish_fk_abun %>% 
  select(YEAR, protected_status, SPECIES_CD, abundance) %>%  
  group_by(YEAR, protected_status) %>% #48 groups 
  nest(-YEAR) %>%  
  mutate(
    data_wide = map(data, ~ spread(data=.x, SPECIES_CD, abundance, fill = 0)), 
     #species richness 
    richness = map(
      data_wide, 
      function(x) specnumber(x)),
    #simpson diversity as effective number of species 
    simpson = map( 
      data_wide,
      function(x) 1/(1 - diversity(x, index = 'simpson'))),
     #shannon diversity as effective number of species 
    shannon = map(
      data_wide,
      function(x) exp(diversity(x, index = 'shannon')))) %>%
  unnest(richness, simpson, shannon)

hogfish_fk_diversity = hogfish_fk_abundance %>%
  select(YEAR, protected_status, richness, simpson, shannon) 
write_csv(hogfish_fk_diversity, "big_csv/trophic_groups/diversity/hogfish_fk_diversity.csv")

```

#### Lionfish
```{r Lionfish, eval = F}

#"PTE VOLI" - lionfish

#abundance
lionfish_fk_abun = getDomainAbundance(RVCdata_FK, "PTE VOLI", merge_protected = F)
write_csv(lionfish_fk_abun, "big_csv/trophic_groups/abundance/lionfish_fk_abun.csv")

lionfish_dt_abun = getDomainAbundance(RVCdata_FK, "PTE VOLI", merge_protected = F)
write_csv(lionfish_dt_abun, "big_csv/trophic_groups/abundance/lionfish_dt_abun.csv")

#density
lionfish_fk_den = getDomainDensity(RVCdata_DT, "PTE VOLI", merge_protected = F)
write_csv(lionfish_fk_den, "big_csv/trophic_groups/density/lionfish_fk_abun.csv")

lionfish_dt_den = getDomainDensity(RVCdata_DT, "PTE VOLI", merge_protected = F)
write_csv(lionfish_dt_den, "big_csv/trophic_groups/density/lionfish_fk_abun.csv")

```

#### Opportunists 
```{r Opportunists, eval = F}

opportunists_spp_list = c("CAR RUBE", "SPH BARR", "ALE CILI","DEC PUNC", "DEC MACA", "CAR CRYS", "CAR BART", "SCO REGA","SPH PICU", "CAR LATU", "SEL VOME", "ELA BIPI", "CAR SPE.", "TRA FALC", "EUT ALLE", "SER RIVO", "SCO MACU", "SER DUME", "SCO CAVA", "SPH GUAC", "CAR LUGU", "OLI SAUR", "SER SPE.", "Rac cana", "Ser zona")

#abundance
opportunists_fk_abun = getDomainAbundance(RVCdata_FK, opportunists_spp_list, merge_protected = F)
write_csv(opportunists_fk_abun, "big_csv/trophic_groups/abundance/opportunists_fk_abun.csv")

opportunists_dt_abun = getDomainAbundance(RVCdata_FK, opportunists_spp_list, merge_protected = F)
write_csv(opportunists_dt_abun, "big_csv/trophic_groups/abundance/opportunists_dt_abun.csv")

#density
opportunists_fk_den = getDomainDensity(RVCdata_DT, opportunists_spp_list, merge_protected = F)
write_csv(opportunists_fk_den, "big_csv/trophic_groups/density/opportunists_fk_den.csv")

opportunists_dt_den = getDomainDensity(RVCdata_DT, opportunists_spp_list, merge_protected = F)
write_csv(opportunists_dt_den, "big_csv/trophic_groups/density/opportunists_dt_den.csv")

#diversity
opportunists_fk_abundance = opportunists_fk_abun %>% 
  select(YEAR, protected_status, SPECIES_CD, abundance) %>%  
  group_by(YEAR, protected_status) %>% #48 groups 
  nest(-YEAR) %>%  
  mutate(
    data_wide = map(data, ~ spread(data=.x, SPECIES_CD, abundance, fill = 0)), 
     #species richness 
    richness = map(
      data_wide, 
      function(x) specnumber(x)),
    #simpson diversity as effective number of species 
    simpson = map( 
      data_wide,
      function(x) 1/(1 - diversity(x, index = 'simpson'))),
     #shannon diversity as effective number of species 
    shannon = map(
      data_wide,
      function(x) exp(diversity(x, index = 'shannon')))) %>%
  unnest(richness, simpson, shannon)

opportunists_fk_diversity = opportunists_fk_abundance %>%
  select(YEAR, protected_status, richness, simpson, shannon) 
write_csv(opportunists_fk_diversity, "big_csv/trophic_groups/diversity/opportunists_fk_diversity.csv")

```

#### Parrotfish
```{r Parrotfish, eval = F}

parrotfish_spp_list = c('SCA ISER', "SCA COEL", "SPA AURO", "SPA VIRI", "SPA ATOM", "SCA TAEN", 'SPA RUBR', "SPA CHRY", "SCA VETU", "SCA COER", "SCA GUAC", "CRY ROSE", "SPA RADI", "SCA SPE.", "NIC USTA", "SPA SPE.")

#abundance
parrotfish_fk_abun = getDomainAbundance(RVCdata_FK, parrotfish_spp_list, merge_protected = F)
write_csv(parrotfish_fk_abun, "big_csv/trophic_groups/abundance/parrotfish_fk_abun.csv")

parrotfish_dt_abun = getDomainAbundance(RVCdata_FK, parrotfish_spp_list, merge_protected = F)
write_csv(parrotfish_dt_abun, "big_csv/trophic_groups/abundance/parrotfish_dt_abun.csv")

#density
parrotfish_fk_den = getDomainDensity(RVCdata_DT, parrotfish_spp_list, merge_protected = F)
write_csv(parrotfish_fk_den, "big_csv/trophic_groups/density/parrotfish_fk_den.csv")

parrotfish_dt_den = getDomainDensity(RVCdata_DT, parrotfish_spp_list, merge_protected = F)
write_csv(parrotfish_dt_den, "big_csv/trophic_groups/density/parrotfish_dt_den.csv")

#diversity
parrotfish_fk_abundance = parrotfish_fk_abun %>% 
  select(YEAR, protected_status, SPECIES_CD, abundance) %>%  
  group_by(YEAR, protected_status) %>% #48 groups 
  nest(-YEAR) %>%  
  mutate(
    data_wide = map(data, ~ spread(data=.x, SPECIES_CD, abundance, fill = 0)), 
     #species richness 
    richness = map(
      data_wide, 
      function(x) specnumber(x)),
    #simpson diversity as effective number of species 
    simpson = map( 
      data_wide,
      function(x) 1/(1 - diversity(x, index = 'simpson'))),
     #shannon diversity as effective number of species 
    shannon = map(
      data_wide,
      function(x) exp(diversity(x, index = 'shannon')))) %>%
  unnest(richness, simpson, shannon)

parrotfish_fk_diversity = parrotfish_fk_abundance %>%
  select(YEAR, protected_status, richness, simpson, shannon) 
write_csv(parrotfish_fk_diversity, "big_csv/trophic_groups/diversity/parrotfish_fk_diversity.csv")

```

#### Rays
```{r Rays, eval = F}

rays_spp_list = c("URO JAMA", "ECH NAUC", "DAS AMER", "AET NARI", "NAR BANC", "Rhi bona")

#abundance
rays_fk_abun = getDomainAbundance(RVCdata_FK, rays_spp_list, merge_protected = F)
write_csv(rays_fk_abun, "big_csv/trophic_groups/abundance/rays_fk_abun.csv")

rays_dt_abun = getDomainAbundance(RVCdata_FK, rays_spp_list, merge_protected = F)
write_csv(rays_dt_abun, "big_csv/trophic_groups/abundance/rays_dt_abun.csv")

#density
rays_fk_den = getDomainDensity(RVCdata_DT, rays_spp_list, merge_protected = F)
write_csv(rays_fk_den, "big_csv/trophic_groups/density/rays_fk_den.csv")

rays_dt_den = getDomainDensity(RVCdata_DT, rays_spp_list, merge_protected = F)
write_csv(rays_dt_den, "big_csv/trophic_groups/density/rays_dt_den.csv")

#diversity
rays_fk_abundance = rays_fk_abun %>% 
  select(YEAR, protected_status, SPECIES_CD, abundance) %>%  
  group_by(YEAR, protected_status) %>% #48 groups 
  nest(-YEAR) %>%  
  mutate(
    data_wide = map(data, ~ spread(data=.x, SPECIES_CD, abundance, fill = 0)), 
     #species richness 
    richness = map(
      data_wide, 
      function(x) specnumber(x)),
    #simpson diversity as effective number of species 
    simpson = map( 
      data_wide,
      function(x) 1/(1 - diversity(x, index = 'simpson'))),
     #shannon diversity as effective number of species 
    shannon = map(
      data_wide,
      function(x) exp(diversity(x, index = 'shannon')))) %>%
  unnest(richness, simpson, shannon)

rays_fk_diversity = rays_fk_abundance %>%
  select(YEAR, protected_status, richness, simpson, shannon) 
write_csv(rays_fk_diversity, "big_csv/trophic_groups/diversity/rays_fk_diversity.csv")

```

#### Sea bass and Hamlets
```{r Sea bass and Hamlets, eval = F}

sea_bass_hamlet_spp_list = c("SER TIGR","HYP GEMM","HYP UNIC","SER TABA","SER BALD","HYP PUEL","EPI ADSC","SER TORT","EPI GUTT","HYP NIGR","DIP FORM","HYP SPE.","SCH BETA","HYP TANN", "RYP SAPO","PAR FURC","HYP INDI","HYP GUTT","ALP AFER","LIO EUKR","SER ANNU","LIO RUBE","HYP HYBR","HYP CHLO","PRI AQUI","RYP MACU","SER SUBL","CEN OCYU","CEN STRI","Epi drum","Lio mowb")

#abundance
seabass_fk_abun = getDomainAbundance(RVCdata_FK, sea_bass_hamlet_spp_list, merge_protected = F)
write_csv(seabass_fk_abun, "big_csv/trophic_groups/abundance/seabass_fk_den.csv")

seabass_dt_abun = getDomainAbundance(RVCdata_FK, sea_bass_hamlet_spp_list, merge_protected = F)
write_csv(seabass_dt_abun, "big_csv/trophic_groups/abundance/seabass_dt_den.csv")

#density
seabass_fk_den = getDomainDensity(RVCdata_DT, sea_bass_hamlet_spp_list, merge_protected = F)
write_csv(seabass_fk_den, "big_csv/trophic_groups/density/seabass_fk_den.csv")

seabass_dt_den = getDomainDensity(RVCdata_DT, sea_bass_hamlet_spp_list, merge_protected = F)
write_csv(seabass_dt_den, "big_csv/trophic_groups/density/seabass_dt_den.csv")

#diversity
seabass_fk_abundance = seabass_fk_abun %>% 
  select(YEAR, protected_status, SPECIES_CD, abundance) %>%  
  group_by(YEAR, protected_status) %>% #48 groups 
  nest(-YEAR) %>%  
  mutate(
    data_wide = map(data, ~ spread(data=.x, SPECIES_CD, abundance, fill = 0)), 
     #species richness 
    richness = map(
      data_wide, 
      function(x) specnumber(x)),
    #simpson diversity as effective number of species 
    simpson = map( 
      data_wide,
      function(x) 1/(1 - diversity(x, index = 'simpson'))),
     #shannon diversity as effective number of species 
    shannon = map(
      data_wide,
      function(x) exp(diversity(x, index = 'shannon')))) %>%
  unnest(richness, simpson, shannon)

seabass_fk_diversity = seabass_fk_abundance %>%
  select(YEAR, protected_status, richness, simpson, shannon) 
write_csv(seabass_fk_diversity, "big_csv/trophic_groups/diversity/seabass_fk_diversity.csv")

```

#### Sharks
```{r Sharks, eval = F}

sharks_spp_list = c("GIN CIRR", "CAR PERE", "CAR LEUC", "CAR LIMB", "SPH MOKA", "SPH TIBU", "CAR FALC", "SPH LEWI", "CAR OBSC", "Neg brev", "CAR PLUM", 'Gal cuvi')

#abundance
sharks_fk_abun = getDomainAbundance(RVCdata_FK, sharks_spp_list, merge_protected = F)
write_csv(sharks_fk_abun, "big_csv/trophic_groups/abundance/sharks_fk_den.csv")

sharks_dt_abun = getDomainAbundance(RVCdata_FK, sharks_spp_list, merge_protected = F)
write_csv(sharks_dt_abun, "big_csv/trophic_groups/abundance/sharks_dt_den.csv")

#density
sharks_fk_den = getDomainDensity(RVCdata_DT, sharks_spp_list, merge_protected = F)
write_csv(sharks_fk_den, "big_csv/trophic_groups/density/sharks_fk_den.csv")

sharks_dt_den = getDomainDensity(RVCdata_DT, sharks_spp_list, merge_protected = F)
write_csv(sharks_dt_den, "big_csv/trophic_groups/density/sharks_dt_den.csv")

#diversity
sharks_fk_abundance = sharks_fk_abun %>% 
  select(YEAR, protected_status, SPECIES_CD, abundance) %>%  
  group_by(YEAR, protected_status) %>% #48 groups 
  nest(-YEAR) %>%  
  mutate(
    data_wide = map(data, ~ spread(data=.x, SPECIES_CD, abundance, fill = 0)), 
     #species richness 
    richness = map(
      data_wide, 
      function(x) specnumber(x)),
    #simpson diversity as effective number of species 
    simpson = map( 
      data_wide,
      function(x) 1/(1 - diversity(x, index = 'simpson'))),
     #shannon diversity as effective number of species 
    shannon = map(
      data_wide,
      function(x) exp(diversity(x, index = 'shannon')))) %>%
  unnest(richness, simpson, shannon)

sharks_fk_diversity = sharks_fk_abundance %>%
  select(YEAR, protected_status, richness, simpson, shannon) 
write_csv(sharks_fk_diversity, "big_csv/trophic_groups/diversity/sharks_fk_diversity.csv")

```

#### Small Reef Fish
```{r Small Reef Fish, eval = F}

small_reef_fish_spp_list = c("COR PERS","ACA COER","KYP SECT","ACA BAHI","ACA CHIR","COR GLAU","ELA OCEA","GNA THOM","PTE CALL","ACA SPE.","MAL TRIA","COR DICR","PAR MARM","MAL MACR","OPH MACC","CTE SAEP","MIC CARR","PTE HELE","HEM SIMU","SCA CRIS","COR EIDO","GOB SPE.","TYL CROC","MIC MICR","ACA ASPE","COR SPE.","BLE SPE.","STR NOTA","MEL NIGE","HYP BERM","EMB PAND","ELA EVEL","ACA CHAP","EMB BAHA","COR LIPE","NES LONG","ENN BOEH","ACA MARI","LAB NUCH","MAL VERS","MAL GILL","ELA MACR","PRI HIPO","GOB DILE","ELA SAUC","ELA XANT","STR TIMU","MAL AURO","PAR MARN","CHA LIMB","OXY STIG","ELA HORS","PAR NIGR","COR PUNC","ACA SPIN","BOL BOQU","ElA RAND","LAB KALI","LAB NIGR","ENN ALTI")

#abundance
small_reef_fk_abun = getDomainAbundance(RVCdata_FK, small_reef_fish_spp_list, merge_protected = F)
write_csv(small_reef_fk_abun, "big_csv/trophic_groups/abundance/small_reef_fk_abun.csv")

small_reef_dt_abun = getDomainAbundance(RVCdata_FK, small_reef_fish_spp_list, merge_protected = F)
write_csv(small_reef_dt_abun, "big_csv/trophic_groups/abundance/small_reef_dt_abun.csv")

#density
small_reef_fk_den = getDomainDensity(RVCdata_DT, small_reef_fish_spp_list, merge_protected = F)
write_csv(small_reef_fk_den, "big_csv/trophic_groups/density/small_reef_fk_den.csv")

small_reef_dt_den = getDomainDensity(RVCdata_DT, small_reef_fish_spp_list, merge_protected = F)
write_csv(small_reef_dt_den, "big_csv/trophic_groups/density/small_reef_dt_den.csv")

#diversity
small_reef_fk_abundance = small_reef_fk_abun %>% 
  select(YEAR, protected_status, SPECIES_CD, abundance) %>%  
  group_by(YEAR, protected_status) %>% #48 groups 
  nest(-YEAR) %>%  
  mutate(
    data_wide = map(data, ~ spread(data=.x, SPECIES_CD, abundance, fill = 0)), 
     #species richness 
    richness = map(
      data_wide, 
      function(x) specnumber(x)),
    #simpson diversity as effective number of species 
    simpson = map( 
      data_wide,
      function(x) 1/(1 - diversity(x, index = 'simpson'))),
     #shannon diversity as effective number of species 
    shannon = map(
      data_wide,
      function(x) exp(diversity(x, index = 'shannon')))) %>%
  unnest(richness, simpson, shannon)

small_reef_fk_diversity = small_reef_fk_abundance %>%
  select(YEAR, protected_status, richness, simpson, shannon) 
write_csv(small_reef_fk_diversity, "big_csv/trophic_groups/diversity/small_reef_fk_diversity.csv")

```

#### Snapper
```{r Snapper, eval = F}

snapper_spp_list = c("OCY CHRY", "LUT GRIS", "LUT ANAL", "LUT APOD", "LUT SYNA", "LUT MAHO", "LUT JOCU", "LUT BUCC", 'LUT SPE.', "LUT CYAN", "RHO AURO", "Lut camp")

#abundance
snapper_fk_abun = getDomainAbundance(RVCdata_FK, snapper_spp_list, merge_protected = F)
write_csv(snapper_fk_abun, "big_csv/trophic_groups/abundance/snapper_fk_abun.csv")

snapper_dt_abun = getDomainAbundance(RVCdata_FK, snapper_spp_list, merge_protected = F)
write_csv(snapper_dt_abun, "big_csv/trophic_groups/abundance/snapper_dt_abun.csv")

#density
snapper_fk_den = getDomainDensity(RVCdata_DT, snapper_spp_list, merge_protected = F)
write_csv(snapper_fk_den, "big_csv/trophic_groups/density/snapper_dt_den.csv")

snapper_dt_den = getDomainDensity(RVCdata_DT, snapper_spp_list, merge_protected = F)
write_csv(snapper_dt_den, "big_csv/trophic_groups/density/snapper_dt_den.csv")

#diversity
snapper_fk_abundance = snapper_fk_abun %>% 
  select(YEAR, protected_status, SPECIES_CD, abundance) %>%  
  group_by(YEAR, protected_status) %>% #48 groups 
  nest(-YEAR) %>%  
  mutate(
    data_wide = map(data, ~ spread(data=.x, SPECIES_CD, abundance, fill = 0)), 
     #species richness 
    richness = map(
      data_wide, 
      function(x) specnumber(x)),
    #simpson diversity as effective number of species 
    simpson = map( 
      data_wide,
      function(x) 1/(1 - diversity(x, index = 'simpson'))),
     #shannon diversity as effective number of species 
    shannon = map(
      data_wide,
      function(x) exp(diversity(x, index = 'shannon')))) %>%
  unnest(richness, simpson, shannon)

snapper_fk_diversity = snapper_fk_abundance %>%
  select(YEAR, protected_status, richness, simpson, shannon) 
write_csv(snapper_fk_diversity, "big_csv/trophic_groups/diversity/snapper_fk_diversity.csv")

```

## Trophic group plots 
```{r Trophic group plots}


```

## Trophic Level 
```{r trophic levels}
#potential visualize as a stacked chart 
trophic_levels = read_csv('big_csv/FKNMS_infographic_list.csv')
# Parsed with column specification:
# cols(
#   Ecological_classification = col_character(),
#   Sanctuary_Classifcation_level = col_character(),
#   Icons = col_character(),
#   Latin_Name = col_character(),
#   Common_Name = col_character(),
#   RVC_CODE = col_character(),
#   Trophic_Level = col_integer(),
#   Representative_Species = col_character(),
#   Dataset = col_character(),
#   Metric = col_character(),
#   Lead = col_character()
# )

trophic_levels = trophic_levels %>%
  select(RVC_CODE, Trophic_Level) %>% 
  group_by(Trophic_Level) #4 trophic levels, #421 species 

```

```{r exploited reef fish: grouper-snapper complex, eval = F}

exploited_spp_list= c(
    "LUT ANAL", #Mutton Snapper
    "LUT GRIS", #Gray Snapper        
    "OCY CHRY", #Yellowtail Snapper 
    "LUT SYNA", #Lane Snapper
    "LUT APOD", #Schoolmaster Snapper 
    "LAC MAXI", #Hogfish
    "EPI ADSC", #Rockhind
    "CEP CRUE", #Graysby
    "EPI GUTT", #Red Hind
    "EPI ITAJ", #Goliath Grouper 
    "EPI MORI", #Red Grouper
    "EPI STRI", #Nassau Grouper 
    "MYC BONA", #Black Grouper
    "MYC VENE", #Yellowfin Grouper
    "MYC PHEN", #Scamp
    "HAE AURO", #Tomtate
    "HAE MELA", #Cottonwick
    "HAE PLUM", #White Grunt
    "HAE SCIU", #Bluestriped 
    "MYC MICR" #Gag 
    )

exploited_den <- getDomainDensity(RVCdata_FK, species = exploited_spp_list, merge_protected = F)

exploited_den <- getDomainDensity(RVCdata_DT, species = exploited_spp_list, merge_protected = F)

```

## Reef Fish Biodiversity 

```{r Biodiversity}

domain_fk_abun_diversity = read_csv('big_csv/abundance_domain/domain_fk_abun_diversity.csv')
domain_dt_abun_diversity = read_csv("big_csv/abundance_domain/domain_dt_abun_diversity.csv")
strata_fk_abun_diversity = read_csv("big_csv/abundance_strata/strata_fk_abun_diversity.csv")
strata_dt_abun_diversity = read_csv("big_csv/abundance_strata/strata_dt_abun_diversity.csv")
psu_fk_abun_diversity = read_csv("big_csv/abundance_psu/psu_fk_abun_diversity.csv", 
          col_types = cols(protected_status = col_character())) 
psu_dt_abun_diversity = read_csv("big_csv/abundance_psu/psu_dt_abun_diversity.csv")

```

### Sea turtles
```{Turtles}

```

### Queen conch
```{Queen conch}

```

### Caribbean spiny lobster 
```{Caribbean spiny lobster}

```

### Long-spinned sea urchin 
```{Long Spinned Sea Urchin}

```